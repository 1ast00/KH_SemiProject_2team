<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.NoticeMapper">

    <!-- NoticeDTO와 NOTICE 테이블 컬럼 매핑 -->
    <resultMap id="noticeResultMap" type="dto.NoticeDTO">
        <id property="num" column="NUM"/>
        <result property="adminSerialNum" column="ADMIN_SERIALNUM"/>
        <result property="title" column="TITLE"/>
        <result property="content" column="CONTENT"/>
        <result property="views" column="VIEWS"/>
        <result property="writeDate" column="WRITE_DATE"/>
        <result property="writeUpdateDate" column="WRITE_UPDATE_DATE"/> 
    </resultMap>

    <!-- 전체 공지사항 개수 조회 -->
    <select id="getTotalNoticeCount" resultType="int">
        SELECT COUNT(*) FROM NOTICE
    </select>

    <!-- 공지사항 목록 조회 (페이징 적용) -->
    <!-- PagingDTO의 page, pageSize를 사용하여 ROWNUM으로 페이징 처리 -->
    <select id="getNoticeList" resultMap="noticeResultMap" parameterType="map">
        SELECT *
        FROM (
            SELECT
                NUM,
                ADMIN_SERIALNUM,
                TITLE,
                CONTENT,
                VIEWS,
                WRITE_DATE,
                WRITE_UPDATE_DATE,
                ROW_NUMBER() OVER (ORDER BY NUM DESC) AS rnum
            FROM NOTICE
        )
        WHERE rnum BETWEEN (#{page} - 1) * #{pageSize} + 1 AND #{page} * #{pageSize}
        ORDER BY NUM DESC
    </select>

    <!-- 공지사항 상세 조회 (선택 사항, 나중에 필요할 때 추가) -->
    <select id="getNoticeByNum" resultMap="noticeResultMap" parameterType="int">
        SELECT * FROM NOTICE WHERE NUM = #{num}
    </select>

    <!-- 조회수 증가 (선택 사항) -->
    <update id="incrementViews" parameterType="int">
        UPDATE NOTICE SET VIEWS = VIEWS + 1 WHERE NUM = #{num}
    </update>

    <select id="getLatestNoticeList" resultMap="noticeResultMap" parameterType="int">
        SELECT NUM, ADMIN_SERIALNUM, TITLE, CONTENT, VIEWS, WRITE_DATE, WRITE_UPDATE_DATE
        FROM (
            SELECT
                NUM, ADMIN_SERIALNUM, TITLE, CONTENT, VIEWS, WRITE_DATE, WRITE_UPDATE_DATE,
                ROW_NUMBER() OVER (ORDER BY NUM DESC) AS rnum
            FROM NOTICE
        )
        WHERE rnum BETWEEN 1 AND #{limit}
        ORDER BY NUM DESC
    </select>

</mapper>
