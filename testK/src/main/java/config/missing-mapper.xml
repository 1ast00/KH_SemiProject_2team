<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.MissingMapper">
	<resultMap type="dto.MissingPersonDTO" id="missing">
		<id column="missing_serialNum" property="missingSerialNum"></id>
		<result column="member_serialNum" property="memberSerialNum" />
		<result column="admin_serialNum" property="adminSerialNum" />
		<result column="missing_name" property="name" />
		<result column="missing_gender" property="gender" />
		<result column="missing_birth" property="birth" />
		<result column="missing_etc" property="etc" />
		<result column="missing_place" property="place" />
		<result column="missing_date" property="missingDate" />
		<result column="missing_img" property="image" />
	</resultMap>

	<insert id="insertMissingPerson"
		parameterType="dto.MissingPersonDTO">
		INSERT INTO missing_info (
		member_serialNum,
		admin_serialNum,
		missing_name,
		missing_gender,
		missing_birth,
		missing_etc,
		missing_place,
		missing_date,
		missing_img
		) VALUES (
		#{memberSerialNum},
		#{adminSerialNum},
		#{name},
		#{gender},
		TO_NUMBER(REPLACE(#{birth}, '-', '')),
		#{etc},
		#{place},
		TO_DATE(#{missingDate}, 'YYYY-MM-DD'),
		#{image}
		)
	</insert>

	<select id="selectMissingList" parameterType="map" resultMap="missing">
		SELECT * FROM (
			SELECT ROWNUM AS rnum, m.* FROM (
				SELECT * FROM missing_info ORDER BY missing_serialNum DESC
			) m
		) WHERE rnum BETWEEN #{startRow} AND #{endRow}
	</select>

	<!-- 데이터베이스에 등록 된 전체 실종자 정보 세기(페이징때문에 추가) -->
	<select id="selectMissingCount" resultType="int">
		SELECT COUNT(*) FROM missing_info
	</select>
	
	<!-- 회원번호로 관리자 번호 조회 -->
	<select id="selectAdminSerialNumByMember" parameterType="string"
		resultType="string">
		SELECT admin_serialNum FROM member_info WHERE member_serialNum =
		#{memberSerialNum}
	</select>

	<delete id="deleteMissingPerson" parameterType="string">
		DELETE FROM missing_info WHERE missing_serialNum = #{missingSerialNum}
	</delete>
</mapper>